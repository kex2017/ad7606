# 核心功能

## 高频过电流事件

1.下载FPGA，并验证FPGA是否正常工作 ok

2.通过SPI接口读写FPGA寄存器。ok

3.过电流中断发生后，读取FPGA的缓存的故障波形及时间，并上传 

4.不发生越界时，周期上送高频电流

## 工频电流

1.实时采集两路工频信号，并计算平方和，判断是否越界

​	1.1发生越界时记录波形和波形第一个采样点的时间，单片机工频电流波形及时间上传

​		1.1.1哪一路越界就上传哪一路

​	1.2不发生越界时，周期上送工频电流

## 监测电池电压、 环境温湿度（PT100）

## 时间设置

1.实时接收北斗模块时间（间隔几分钟读取一次）供STM32和FPGA使用

2.北斗没时间时，从后台获取，后台判断单片机心跳时间不正常时主动下发设置时间命令

3.读取/设置单片机时间

## 通道参数

1.设置工频/高频门限变化率

## 校准

1.内置四组校准系数且命令行可配置(增加后台设置)（工频通道0、工频通道1、高频通道0、高频通道1）

2.校准系数上传（上传写入的数值）

3.计算工频电流和高频电流时用校准系数调整



# 低功耗模式功能

1.单片机停止AD采样

2.关闭FPGA电源和模拟部分电源

3.采集电池电压时，需要开启模拟部分电源

4.7.5V进入，8v退出

# 功能验证

## 工频电流验证：

​	1.输入10A~10KA的工频电流，查看后台是否等正确显示电流值，线性度误差<15%.

​	2.将工频电流源输出设置为5A，单片机的工频门限设置为7A，将工频电流源输出从5A改为7.5A，查看后台系统抓取到单片机上传的工频电流波形和告警。

## 高频电流验证：

​	1.通过后台将FPGA里高频电流的门限设置为4A，调试冲击电流源，输出5A 8-20uS冲击电流，查看后台系统抓取到FPGA上传的冲击电流波形和告警。

​	2.用一根30米长的线短接冲击电流源输出脚，将两套采集装置的罗氏线圈卡在首位两端，产生冲击波形，查看两个采集装置是否告警，且抓到异常波形的时间差=理论值。

# 其他功能

1.远程升级STM32代码和FPGA代码

2.从北斗模块读取经纬度信息并发送给后台

3.命令行配置自身地址

4.读取版本

5.心跳

6.看门狗



# 功能疑问

2.工频波形平时需要（最好）

3.高频发生时，记录工频波形

4.INT_TO_FPGA pin作用（暂时没用）

5.OPA_PWR_CTR pin作用（控制模拟部分电源)

6.模拟部分增益不需要

7.PT100（不用），电池电压引脚用

8.单片机选一路质量好（判断标准:判断有没有大于或等于4095，同时没有一出优先选择6倍）



